
clear
%% Setting for Physical Decay Correction
Decay_ind=1; % 1: Doing Decay Correction, 0: X Decay Correction
%lamda=0.006; % 18F(e.g.,DCF,AmBF3):6.3185*10^(-3), 177Lu=7.2416*10^(-5), 68Ga(e.g., HTK): 0.01019334
%lamda=0.006; % DCFPyL
%lamda=0.01019334; % HTK
%lamda=0.006; % AmBF3
lamda=0.006; % FDG

%% Importing Multiple WB data & Gen. of IDIF
tic;
[Num_Passes,Num_Beds,Vol_WB,Vol_Multi_WB,Raw_Data_Multi_WB,Times_Multi_WB,Num_Times_Multi_WB]=Import_Dynamic_DCM_Multiple();
save Num_Passes.mat Num_Passes;
save Num_Beds.mat Num_Beds;
save("Vol_WB.mat",'Vol_WB','-v7.3','-nocompression');
save("Vol_Multi_WB.mat",'Vol_Multi_WB','-v7.3','-nocompression');
save Raw_Data_Multi_WB.mat Raw_Data_Multi_WB;
save Times_Multi_WB.mat Times_Multi_WB;
save Num_Times_Multi_WB.mat Num_Times_Multi_WB;
% Extracting LV data from WB
[LV_kBq,LV_PI_Time_Min]=Gen_WB_Input_IDIF(Num_Passes,Num_Beds,Vol_WB,Vol_Multi_WB,Raw_Data_Multi_WB,Times_Multi_WB,Num_Times_Multi_WB);
toc;
global Local_Estimates;
tic;
[Local_Estimates, Local_SSE, Plot_Measured, Plot_Fitted, Plot_IDIF]=Gen_IDIF(LV_kBq,LV_PI_Time_Min,Decay_ind,lamda);
%[Local_Estimates, Local_SSE, Plot_Measured, Plot_Fitted, Plot_IDIF]=Gen_IDIF(LV_kBq,LV_PI_Time_Min,0,0.006); % No Decay Correction
toc;

%% Making 4D Arrays(Decay Corrected) of WB_kBq [kBq/ml], PI_Time [min], C_tot_over_C_p, and Integ_C_t_over_C_p  
tic;
%Make_4D_Array(Num_Passes,Num_Beds,Vol_WB,Vol_Multi_WB,Times_Multi_WB, Raw_Data_Multi_WB.Pass_1{1, 1}.RadiopharmaceuticalStartTime, Decay_ind, lamda);
Make_4D_Array(Num_Passes,Num_Beds,Vol_WB,Vol_Multi_WB,Times_Multi_WB, Raw_Data_Multi_WB.Pass_1{1, 1}.RadiopharmaceuticalInformationSequence.Item_1.RadiopharmaceuticalStartTime, Decay_ind, lamda);
save Num_Passes.mat Num_Passes;
save Num_Beds.mat Num_Beds;
toc; % 0.5 [min] for 16 Passes
clear

% Making WB_mask & Application into 4D Arrays (to reduce comp. time)
load kBq
WB_thre=0.1; %[kBq/ml]
origin=kBq(:,:,:,1);
WB_mask=ones(size(origin)); 
WB_mask(find(origin < WB_thre))=0;
for p=1:1:size(kBq,4)
    filt_kBq(:,:,:,p)=kBq(:,:,:,p).*WB_mask;
end
kBq=filt_kBq;
save("WB_mask.mat",'WB_mask','-v7.3','-nocompression');
save("kBq.mat",'kBq','-v7.3','-nocompression');
clear
%% Generation of Parametric Volume (PGA)
t1=clock;
load Num_Passes
load Num_Beds
%Starting_Patlak=[1;100]; % K_i:net influx rate (slope), V_d: volume of dist. (intercept)
%LB_Patlak=[0;-1000]; % Lower Bound of the Kinetic Parameters (i.e., Rate Constants)
%UB_Patlak=[10;1000]; % Upper Bound of the Kinetic Parameters (i.e., Rate Constants)
Starting_Patlak=[0.5;0.5]; % K_i:net influx rate (slope), V_d: volume of dist. (intercept)
LB_Patlak=[0;0]; % Lower Bound of the Kinetic Parameters (i.e., Rate Constants)
UB_Patlak=[1;25]; % Upper Bound of the Kinetic Parameters (i.e., Rate Constants)
Gen_Parametric_Vol_Patlak(Num_Passes, Num_Beds, Starting_Patlak, LB_Patlak, UB_Patlak); 
t2=clock; % 6 [min] (using GPUfit)
e_time=etime(t2,t1)/60 % [min]
save E_time_PGA.mat e_time
clear
%% Generation of Parametric Volume (2TCM)
% Kinetic Modeling with Two Tissue Comp. Model (w/o liniearization)
load Num_Passes
load Num_Beds
t1=clock;
Starting_TTCM=[0.01;0.01;0.001;0]; % K_1;K_2;K_3;K_4
LB_TTCM=[0;0;0;0]; % Lower Bound of the Kinetic Parameters (i.e., Rate Constants)
UB_TTCM=[1;1;0.5;0]; % Upper Bound of the Kinetic Parameters (i.e., Rate Constants)
Gen_Parametric_Vol_TTCM(Num_Passes, Num_Beds, Starting_TTCM, LB_TTCM, UB_TTCM); 
t2=clock; % 58 [min] (using GPUfit)
e_time=etime(t2,t1)/60 % [min]
save E_time_2TCM.mat e_time
clear

%% Generation of Parametric Volume (PCDE)
Denoising_Ind=0; % Denoising with FLT
global Local_Estimates
load Local_Estimates;
load PI_Times_Multi_WB.mat;
load Vol_Multi_WB_PCDE.mat;
load kBq;
load PI_Time;
load Num_Passes;
load Num_Beds;
PI_Times_PCDE=cell2mat(struct2cell(PI_Times_Multi_WB));
t1=clock;
%chosen_params_WB=PCDE_WB(Num_Passes, Num_Beds,PI_Times_PCDE,Denoising_Ind); % Original Version
%chosen_params_WB=PCDE_WB_ACC_Version(Vol_Multi_WB_PCDE, Num_Passes,Num_Beds, PI_Times_PCDE, Denoising_Ind); % Accelerated Version
%chosen_params_WB=PCDE_WB_half(Num_Passes, Num_Beds, PI_Times_PCDE, Vol_Multi_WB, kBq, PI_Time);
Optim_Ks=PCDE_WB_Speedy(PI_Time,kBq,Vol_Multi_WB_PCDE, Num_Passes,Num_Beds, PI_Times_PCDE, Local_Estimates,Denoising_Ind);
t2=clock;
Elapsed_Time=etime(t2,t1)/60 % [min]
save E_time_PCDE.mat Elapsed_Time
save Optim_Ks.mat Optim_Ks

%% Saving the parametric volume into DCM files
% for Patlak
clear
load Raw_Data_Multi_WB.mat
load WB_mask.mat
load K_i;
load V_d;
inpKi={'FDG_P2_PGA_Ki', '[1/min]'};
inpVd={'FDG_P2_PGA_Vd', 'Unitless'};
Vol_to_DCM(K_i.*WB_mask*1000, Raw_Data_Multi_WB, inpKi);
Vol_to_DCM(V_d.*WB_mask*1000, Raw_Data_Multi_WB, inpVd);
% for 2TCM
clear
load Raw_Data_Multi_WB.mat
load WB_mask.mat
load k1;
load k2;
load k3;
inpK1={'FDG_P2_2TCM_K1', '[1/min]'};
inpk2={'FDG_P2_2TCM_k2', '[1/min]'};
inpk3={'FDG_P2_2TCM_k3', '[1/min]'};
Vol_to_DCM(k1.*WB_mask, Raw_Data_Multi_WB, inpK1);
Vol_to_DCM(k2.*WB_mask, Raw_Data_Multi_WB, inpk2);
Vol_to_DCM(k3.*WB_mask, Raw_Data_Multi_WB, inpk3);
% for PCDE
clear
load Raw_Data_Multi_WB.mat
load WB_mask.mat
load Optim_Ks;
k1_PCDE=squeeze(Optim_Ks(:,:,:,1));
k2_PCDE=squeeze(Optim_Ks(:,:,:,2));
k3_PCDE=squeeze(Optim_Ks(:,:,:,3));
Ki_PCDE=(k1_PCDE.*k3_PCDE)./ (k2_PCDE+k3_PCDE);
Vd_PCDE=(k1_PCDE.*k2_PCDE) ./ ((k2_PCDE+k3_PCDE).^(2));
Ki_PCDE(isnan(Ki_PCDE))=0;
Vd_PCDE(isnan(Vd_PCDE))=0;
inpKi={'FDG_P2_PCDE_Ki', '[1/min]'};
inpVd={'FDG_P2_PCDE_Vd', 'Unitless'};
inpK1={'FDG_P2_PCDE_K1', '[1/min]'};
inpk2={'FDG_P2_PCDE_k2', '[1/min]'};
inpk3={'FDG_P2_PCDE_k3', '[1/min]'};
Vol_to_DCM(Ki_PCDE.*WB_mask*1000, Raw_Data_Multi_WB, inpKi);
Vol_to_DCM(Vd_PCDE.*WB_mask*1000, Raw_Data_Multi_WB, inpVd);
Vol_to_DCM(k1_PCDE.*WB_mask, Raw_Data_Multi_WB, inpK1);
Vol_to_DCM(k2_PCDE.*WB_mask, Raw_Data_Multi_WB, inpk2);
Vol_to_DCM(k3_PCDE.*WB_mask, Raw_Data_Multi_WB, inpk3);
clear



%% for a single Coronal Slice (PCDE)
%Denoising_Ind=1; % 1: Denoising with FLT, 0: X De-noising
%load Local_Estimates;
%load PI_Times_Multi_WB.mat;
%load Vol_Multi_WB_PCDE.mat;
%load kBq;
%load PI_Time;
%load Num_Passes;
%load Num_Beds;
%kBq_coro=zeros(size(kBq),'single');
%kBq_coro(115,:,:,:)=kBq(115,:,:,:); % coronal slice
%PI_Times_PCDE=cell2mat(struct2cell(PI_Times_Multi_WB));
%t1=clock;
%Optim_Ks=PCDE_WB_Speedy(PI_Time,kBq_coro,Vol_Multi_WB_PCDE, Num_Passes,Num_Beds, PI_Times_PCDE, Local_Estimates,Denoising_Ind);
%t2=clock;
%Elapsed_Time=etime(t2,t1)/60 % [min]
%save E_time_PCDE.mat Elapsed_Time
%save Optim_Ks.mat Optim_Ks


%% Pre-plot (2TCM)
%Slice_ind=115;
%K1=flip(imrotate(squeeze(k1(Slice_ind,:,:)), -90),2);
%k2=flip(imrotate(squeeze(k2(Slice_ind,:,:)), -90),2);
%k3=flip(imrotate(squeeze(k3(Slice_ind,:,:)), -90),2);
%k4=flip(imrotate(squeeze(k4(Slice_ind,:,:)), -90),2);
%Ki= (K1.*k3) ./ (k2+k3);
%Vd= (K1.*k2) ./ ((k2+k3).^(2));

%% Pre-plot (PCDE)
%Slice_ind=115;
%K1=flip(imrotate(squeeze(Optim_Ks(Slice_ind,:,:,1)), -90),2);
%k2=flip(imrotate(squeeze(Optim_Ks(Slice_ind,:,:,2)), -90),2);
%k3=flip(imrotate(squeeze(Optim_Ks(Slice_ind,:,:,3)), -90),2);
%k4=flip(imrotate(squeeze(Optim_Ks(Slice_ind,:,:,4)), -90),2);
%Ki= (K1.*k3) ./ (k2+k3);
%Vd= (K1.*k2) ./ ((k2+k3).^(2));

%% Pre-plot (PGA)
%Slice_ind=115;
%Ki=flip(imrotate(squeeze(K_i(Slice_ind,:,:)), -90),2);
%Vd=flip(imrotate(squeeze(V_d(Slice_ind,:,:)), -90),2);


%% Plotting (PGA)
%figure1 = figure;
%subplot1 = subplot(1,2,1,'Parent',figure1); % for Ki
%axis off
%hold(subplot1,'on');
%image(Ki,'Parent',subplot1,'CDataMapping','scaled','Interpolation', 'bilinear');
%title({'Ki'});
%set(subplot1,'CLim',[0.001 1],'ColorScale','log','Colormap',...
%    [0.0104166666666667 0 0;0.0208333333333333 0 0;0.03125 0 0;0.0416666666666667 0 0;0.0520833333333333 0 0;0.0625 0 0;0.0729166666666667 0 0;0.0833333333333333 0 0;0.09375 0 0;0.104166666666667 0 0;0.114583333333333 0 0;0.125 0 0;0.135416666666667 0 0;0.145833333333333 0 0;0.15625 0 0;0.166666666666667 0 0;0.177083333333333 0 0;0.1875 0 0;0.197916666666667 0 0;0.208333333333333 0 0;0.21875 0 0;0.229166666666667 0 0;0.239583333333333 0 0;0.25 0 0;0.260416666666667 0 0;0.270833333333333 0 0;0.28125 0 0;0.291666666666667 0 0;0.302083333333333 0 0;0.3125 0 0;0.322916666666667 0 0;0.333333333333333 0 0;0.34375 0 0;0.354166666666667 0 0;0.364583333333333 0 0;0.375 0 0;0.385416666666667 0 0;0.395833333333333 0 0;0.40625 0 0;0.416666666666667 0 0;0.427083333333333 0 0;0.4375 0 0;0.447916666666667 0 0;0.458333333333333 0 0;0.46875 0 0;0.479166666666667 0 0;0.489583333333333 0 0;0.5 0 0;0.510416666666667 0 0;0.520833333333333 0 0;0.53125 0 0;0.541666666666667 0 0;0.552083333333333 0 0;0.5625 0 0;0.572916666666667 0 0;0.583333333333333 0 0;0.59375 0 0;0.604166666666667 0 0;0.614583333333333 0 0;0.625 0 0;0.635416666666667 0 0;0.645833333333333 0 0;0.65625 0 0;0.666666666666667 0 0;0.677083333333333 0 0;0.6875 0 0;0.697916666666667 0 0;0.708333333333333 0 0;0.71875 0 0;0.729166666666667 0 0;0.739583333333333 0 0;0.75 0 0;0.760416666666667 0 0;0.770833333333333 0 0;0.78125 0 0;0.791666666666667 0 0;0.802083333333333 0 0;0.8125 0 0;0.822916666666667 0 0;0.833333333333333 0 0;0.84375 0 0;0.854166666666667 0 0;0.864583333333333 0 0;0.875 0 0;0.885416666666667 0 0;0.895833333333333 0 0;0.90625 0 0;0.916666666666667 0 0;0.927083333333333 0 0;0.9375 0 0;0.947916666666667 0 0;0.958333333333333 0 0;0.96875 0 0;0.979166666666667 0 0;0.989583333333333 0 0;1 0 0;1 0.0104166666666667 0;1 0.0208333333333333 0;1 0.03125 0;1 0.0416666666666667 0;1 0.0520833333333333 0;1 0.0625 0;1 0.0729166666666667 0;1 0.0833333333333333 0;1 0.09375 0;1 0.104166666666667 0;1 0.114583333333333 0;1 0.125 0;1 0.135416666666667 0;1 0.145833333333333 0;1 0.15625 0;1 0.166666666666667 0;1 0.177083333333333 0;1 0.1875 0;1 0.197916666666667 0;1 0.208333333333333 0;1 0.21875 0;1 0.229166666666667 0;1 0.239583333333333 0;1 0.25 0;1 0.260416666666667 0;1 0.270833333333333 0;1 0.28125 0;1 0.291666666666667 0;1 0.302083333333333 0;1 0.3125 0;1 0.322916666666667 0;1 0.333333333333333 0;1 0.34375 0;1 0.354166666666667 0;1 0.364583333333333 0;1 0.375 0;1 0.385416666666667 0;1 0.395833333333333 0;1 0.40625 0;1 0.416666666666667 0;1 0.427083333333333 0;1 0.4375 0;1 0.447916666666667 0;1 0.458333333333333 0;1 0.46875 0;1 0.479166666666667 0;1 0.489583333333333 0;1 0.5 0;1 0.510416666666667 0;1 0.520833333333333 0;1 0.53125 0;1 0.541666666666667 0;1 0.552083333333333 0;1 0.5625 0;1 0.572916666666667 0;1 0.583333333333333 0;1 0.59375 0;1 0.604166666666667 0;1 0.614583333333333 0;1 0.625 0;1 0.635416666666667 0;1 0.645833333333333 0;1 0.65625 0;1 0.666666666666667 0;1 0.677083333333333 0;1 0.6875 0;1 0.697916666666667 0;1 0.708333333333333 0;1 0.71875 0;1 0.729166666666667 0;1 0.739583333333333 0;1 0.75 0;1 0.760416666666667 0;1 0.770833333333333 0;1 0.78125 0;1 0.791666666666667 0;1 0.802083333333333 0;1 0.8125 0;1 0.822916666666667 0;1 0.833333333333333 0;1 0.84375 0;1 0.854166666666667 0;1 0.864583333333333 0;1 0.875 0;1 0.885416666666667 0;1 0.895833333333333 0;1 0.90625 0;1 0.916666666666667 0;1 0.927083333333333 0;1 0.9375 0;1 0.947916666666667 0;1 0.958333333333333 0;1 0.96875 0;1 0.979166666666667 0;1 0.989583333333333 0;1 1 0;1 1 0.015625;1 1 0.03125;1 1 0.046875;1 1 0.0625;1 1 0.078125;1 1 0.09375;1 1 0.109375;1 1 0.125;1 1 0.140625;1 1 0.15625;1 1 0.171875;1 1 0.1875;1 1 0.203125;1 1 0.21875;1 1 0.234375;1 1 0.25;1 1 0.265625;1 1 0.28125;1 1 0.296875;1 1 0.3125;1 1 0.328125;1 1 0.34375;1 1 0.359375;1 1 0.375;1 1 0.390625;1 1 0.40625;1 1 0.421875;1 1 0.4375;1 1 0.453125;1 1 0.46875;1 1 0.484375;1 1 0.5;1 1 0.515625;1 1 0.53125;1 1 0.546875;1 1 0.5625;1 1 0.578125;1 1 0.59375;1 1 0.609375;1 1 0.625;1 1 0.640625;1 1 0.65625;1 1 0.671875;1 1 0.6875;1 1 0.703125;1 1 0.71875;1 1 0.734375;1 1 0.75;1 1 0.765625;1 1 0.78125;1 1 0.796875;1 1 0.8125;1 1 0.828125;1 1 0.84375;1 1 0.859375;1 1 0.875;1 1 0.890625;1 1 0.90625;1 1 0.921875;1 1 0.9375;1 1 0.953125;1 1 0.96875;1 1 0.984375;1 1 1]);
%colorbar(subplot1);
%subplot2 = subplot(1,2,2,'Parent',figure1); % for Vd
%axis off
%hold(subplot2,'on');
%image(Vd,'Parent',subplot2,'CDataMapping','scaled','Interpolation', 'bilinear');
%title({'Vd'});
%set(subplot2,'CLim',[0.01 10],'ColorScale','log','Colormap',...
%    [0.0104166666666667 0 0;0.0208333333333333 0 0;0.03125 0 0;0.0416666666666667 0 0;0.0520833333333333 0 0;0.0625 0 0;0.0729166666666667 0 0;0.0833333333333333 0 0;0.09375 0 0;0.104166666666667 0 0;0.114583333333333 0 0;0.125 0 0;0.135416666666667 0 0;0.145833333333333 0 0;0.15625 0 0;0.166666666666667 0 0;0.177083333333333 0 0;0.1875 0 0;0.197916666666667 0 0;0.208333333333333 0 0;0.21875 0 0;0.229166666666667 0 0;0.239583333333333 0 0;0.25 0 0;0.260416666666667 0 0;0.270833333333333 0 0;0.28125 0 0;0.291666666666667 0 0;0.302083333333333 0 0;0.3125 0 0;0.322916666666667 0 0;0.333333333333333 0 0;0.34375 0 0;0.354166666666667 0 0;0.364583333333333 0 0;0.375 0 0;0.385416666666667 0 0;0.395833333333333 0 0;0.40625 0 0;0.416666666666667 0 0;0.427083333333333 0 0;0.4375 0 0;0.447916666666667 0 0;0.458333333333333 0 0;0.46875 0 0;0.479166666666667 0 0;0.489583333333333 0 0;0.5 0 0;0.510416666666667 0 0;0.520833333333333 0 0;0.53125 0 0;0.541666666666667 0 0;0.552083333333333 0 0;0.5625 0 0;0.572916666666667 0 0;0.583333333333333 0 0;0.59375 0 0;0.604166666666667 0 0;0.614583333333333 0 0;0.625 0 0;0.635416666666667 0 0;0.645833333333333 0 0;0.65625 0 0;0.666666666666667 0 0;0.677083333333333 0 0;0.6875 0 0;0.697916666666667 0 0;0.708333333333333 0 0;0.71875 0 0;0.729166666666667 0 0;0.739583333333333 0 0;0.75 0 0;0.760416666666667 0 0;0.770833333333333 0 0;0.78125 0 0;0.791666666666667 0 0;0.802083333333333 0 0;0.8125 0 0;0.822916666666667 0 0;0.833333333333333 0 0;0.84375 0 0;0.854166666666667 0 0;0.864583333333333 0 0;0.875 0 0;0.885416666666667 0 0;0.895833333333333 0 0;0.90625 0 0;0.916666666666667 0 0;0.927083333333333 0 0;0.9375 0 0;0.947916666666667 0 0;0.958333333333333 0 0;0.96875 0 0;0.979166666666667 0 0;0.989583333333333 0 0;1 0 0;1 0.0104166666666667 0;1 0.0208333333333333 0;1 0.03125 0;1 0.0416666666666667 0;1 0.0520833333333333 0;1 0.0625 0;1 0.0729166666666667 0;1 0.0833333333333333 0;1 0.09375 0;1 0.104166666666667 0;1 0.114583333333333 0;1 0.125 0;1 0.135416666666667 0;1 0.145833333333333 0;1 0.15625 0;1 0.166666666666667 0;1 0.177083333333333 0;1 0.1875 0;1 0.197916666666667 0;1 0.208333333333333 0;1 0.21875 0;1 0.229166666666667 0;1 0.239583333333333 0;1 0.25 0;1 0.260416666666667 0;1 0.270833333333333 0;1 0.28125 0;1 0.291666666666667 0;1 0.302083333333333 0;1 0.3125 0;1 0.322916666666667 0;1 0.333333333333333 0;1 0.34375 0;1 0.354166666666667 0;1 0.364583333333333 0;1 0.375 0;1 0.385416666666667 0;1 0.395833333333333 0;1 0.40625 0;1 0.416666666666667 0;1 0.427083333333333 0;1 0.4375 0;1 0.447916666666667 0;1 0.458333333333333 0;1 0.46875 0;1 0.479166666666667 0;1 0.489583333333333 0;1 0.5 0;1 0.510416666666667 0;1 0.520833333333333 0;1 0.53125 0;1 0.541666666666667 0;1 0.552083333333333 0;1 0.5625 0;1 0.572916666666667 0;1 0.583333333333333 0;1 0.59375 0;1 0.604166666666667 0;1 0.614583333333333 0;1 0.625 0;1 0.635416666666667 0;1 0.645833333333333 0;1 0.65625 0;1 0.666666666666667 0;1 0.677083333333333 0;1 0.6875 0;1 0.697916666666667 0;1 0.708333333333333 0;1 0.71875 0;1 0.729166666666667 0;1 0.739583333333333 0;1 0.75 0;1 0.760416666666667 0;1 0.770833333333333 0;1 0.78125 0;1 0.791666666666667 0;1 0.802083333333333 0;1 0.8125 0;1 0.822916666666667 0;1 0.833333333333333 0;1 0.84375 0;1 0.854166666666667 0;1 0.864583333333333 0;1 0.875 0;1 0.885416666666667 0;1 0.895833333333333 0;1 0.90625 0;1 0.916666666666667 0;1 0.927083333333333 0;1 0.9375 0;1 0.947916666666667 0;1 0.958333333333333 0;1 0.96875 0;1 0.979166666666667 0;1 0.989583333333333 0;1 1 0;1 1 0.015625;1 1 0.03125;1 1 0.046875;1 1 0.0625;1 1 0.078125;1 1 0.09375;1 1 0.109375;1 1 0.125;1 1 0.140625;1 1 0.15625;1 1 0.171875;1 1 0.1875;1 1 0.203125;1 1 0.21875;1 1 0.234375;1 1 0.25;1 1 0.265625;1 1 0.28125;1 1 0.296875;1 1 0.3125;1 1 0.328125;1 1 0.34375;1 1 0.359375;1 1 0.375;1 1 0.390625;1 1 0.40625;1 1 0.421875;1 1 0.4375;1 1 0.453125;1 1 0.46875;1 1 0.484375;1 1 0.5;1 1 0.515625;1 1 0.53125;1 1 0.546875;1 1 0.5625;1 1 0.578125;1 1 0.59375;1 1 0.609375;1 1 0.625;1 1 0.640625;1 1 0.65625;1 1 0.671875;1 1 0.6875;1 1 0.703125;1 1 0.71875;1 1 0.734375;1 1 0.75;1 1 0.765625;1 1 0.78125;1 1 0.796875;1 1 0.8125;1 1 0.828125;1 1 0.84375;1 1 0.859375;1 1 0.875;1 1 0.890625;1 1 0.90625;1 1 0.921875;1 1 0.9375;1 1 0.953125;1 1 0.96875;1 1 0.984375;1 1 1]);
%colorbar(subplot2);


%% Plotting (with K1,k2,k3,Ki,Vd==> 2TCM, PCDE)
%figure1 = figure;
%subplot1 = subplot(1,5,1,'Parent',figure1); % for K1
%axis off
%hold(subplot1,'on');
%image(K1,'Parent',subplot1,'CDataMapping','scaled', 'Interpolation', 'bilinear');
%title({'K1'});
%set(subplot1,'CLim',[0.01 1],'ColorScale','log','Colormap',...
%    [0.0104166666666667 0 0;0.0208333333333333 0 0;0.03125 0 0;0.0416666666666667 0 0;0.0520833333333333 0 0;0.0625 0 0;0.0729166666666667 0 0;0.0833333333333333 0 0;0.09375 0 0;0.104166666666667 0 0;0.114583333333333 0 0;0.125 0 0;0.135416666666667 0 0;0.145833333333333 0 0;0.15625 0 0;0.166666666666667 0 0;0.177083333333333 0 0;0.1875 0 0;0.197916666666667 0 0;0.208333333333333 0 0;0.21875 0 0;0.229166666666667 0 0;0.239583333333333 0 0;0.25 0 0;0.260416666666667 0 0;0.270833333333333 0 0;0.28125 0 0;0.291666666666667 0 0;0.302083333333333 0 0;0.3125 0 0;0.322916666666667 0 0;0.333333333333333 0 0;0.34375 0 0;0.354166666666667 0 0;0.364583333333333 0 0;0.375 0 0;0.385416666666667 0 0;0.395833333333333 0 0;0.40625 0 0;0.416666666666667 0 0;0.427083333333333 0 0;0.4375 0 0;0.447916666666667 0 0;0.458333333333333 0 0;0.46875 0 0;0.479166666666667 0 0;0.489583333333333 0 0;0.5 0 0;0.510416666666667 0 0;0.520833333333333 0 0;0.53125 0 0;0.541666666666667 0 0;0.552083333333333 0 0;0.5625 0 0;0.572916666666667 0 0;0.583333333333333 0 0;0.59375 0 0;0.604166666666667 0 0;0.614583333333333 0 0;0.625 0 0;0.635416666666667 0 0;0.645833333333333 0 0;0.65625 0 0;0.666666666666667 0 0;0.677083333333333 0 0;0.6875 0 0;0.697916666666667 0 0;0.708333333333333 0 0;0.71875 0 0;0.729166666666667 0 0;0.739583333333333 0 0;0.75 0 0;0.760416666666667 0 0;0.770833333333333 0 0;0.78125 0 0;0.791666666666667 0 0;0.802083333333333 0 0;0.8125 0 0;0.822916666666667 0 0;0.833333333333333 0 0;0.84375 0 0;0.854166666666667 0 0;0.864583333333333 0 0;0.875 0 0;0.885416666666667 0 0;0.895833333333333 0 0;0.90625 0 0;0.916666666666667 0 0;0.927083333333333 0 0;0.9375 0 0;0.947916666666667 0 0;0.958333333333333 0 0;0.96875 0 0;0.979166666666667 0 0;0.989583333333333 0 0;1 0 0;1 0.0104166666666667 0;1 0.0208333333333333 0;1 0.03125 0;1 0.0416666666666667 0;1 0.0520833333333333 0;1 0.0625 0;1 0.0729166666666667 0;1 0.0833333333333333 0;1 0.09375 0;1 0.104166666666667 0;1 0.114583333333333 0;1 0.125 0;1 0.135416666666667 0;1 0.145833333333333 0;1 0.15625 0;1 0.166666666666667 0;1 0.177083333333333 0;1 0.1875 0;1 0.197916666666667 0;1 0.208333333333333 0;1 0.21875 0;1 0.229166666666667 0;1 0.239583333333333 0;1 0.25 0;1 0.260416666666667 0;1 0.270833333333333 0;1 0.28125 0;1 0.291666666666667 0;1 0.302083333333333 0;1 0.3125 0;1 0.322916666666667 0;1 0.333333333333333 0;1 0.34375 0;1 0.354166666666667 0;1 0.364583333333333 0;1 0.375 0;1 0.385416666666667 0;1 0.395833333333333 0;1 0.40625 0;1 0.416666666666667 0;1 0.427083333333333 0;1 0.4375 0;1 0.447916666666667 0;1 0.458333333333333 0;1 0.46875 0;1 0.479166666666667 0;1 0.489583333333333 0;1 0.5 0;1 0.510416666666667 0;1 0.520833333333333 0;1 0.53125 0;1 0.541666666666667 0;1 0.552083333333333 0;1 0.5625 0;1 0.572916666666667 0;1 0.583333333333333 0;1 0.59375 0;1 0.604166666666667 0;1 0.614583333333333 0;1 0.625 0;1 0.635416666666667 0;1 0.645833333333333 0;1 0.65625 0;1 0.666666666666667 0;1 0.677083333333333 0;1 0.6875 0;1 0.697916666666667 0;1 0.708333333333333 0;1 0.71875 0;1 0.729166666666667 0;1 0.739583333333333 0;1 0.75 0;1 0.760416666666667 0;1 0.770833333333333 0;1 0.78125 0;1 0.791666666666667 0;1 0.802083333333333 0;1 0.8125 0;1 0.822916666666667 0;1 0.833333333333333 0;1 0.84375 0;1 0.854166666666667 0;1 0.864583333333333 0;1 0.875 0;1 0.885416666666667 0;1 0.895833333333333 0;1 0.90625 0;1 0.916666666666667 0;1 0.927083333333333 0;1 0.9375 0;1 0.947916666666667 0;1 0.958333333333333 0;1 0.96875 0;1 0.979166666666667 0;1 0.989583333333333 0;1 1 0;1 1 0.015625;1 1 0.03125;1 1 0.046875;1 1 0.0625;1 1 0.078125;1 1 0.09375;1 1 0.109375;1 1 0.125;1 1 0.140625;1 1 0.15625;1 1 0.171875;1 1 0.1875;1 1 0.203125;1 1 0.21875;1 1 0.234375;1 1 0.25;1 1 0.265625;1 1 0.28125;1 1 0.296875;1 1 0.3125;1 1 0.328125;1 1 0.34375;1 1 0.359375;1 1 0.375;1 1 0.390625;1 1 0.40625;1 1 0.421875;1 1 0.4375;1 1 0.453125;1 1 0.46875;1 1 0.484375;1 1 0.5;1 1 0.515625;1 1 0.53125;1 1 0.546875;1 1 0.5625;1 1 0.578125;1 1 0.59375;1 1 0.609375;1 1 0.625;1 1 0.640625;1 1 0.65625;1 1 0.671875;1 1 0.6875;1 1 0.703125;1 1 0.71875;1 1 0.734375;1 1 0.75;1 1 0.765625;1 1 0.78125;1 1 0.796875;1 1 0.8125;1 1 0.828125;1 1 0.84375;1 1 0.859375;1 1 0.875;1 1 0.890625;1 1 0.90625;1 1 0.921875;1 1 0.9375;1 1 0.953125;1 1 0.96875;1 1 0.984375;1 1 1]);
%colorbar(subplot1);
%subplot2 = subplot(1,5,2,'Parent',figure1); % for k2
%axis off
%hold(subplot2,'on');
%image(k2,'Parent',subplot2,'CDataMapping','scaled','Interpolation', 'bilinear');
%title({'k2'});
%set(subplot2,'CLim',[0.01 1],'ColorScale','log','Colormap',...
%    [0.0104166666666667 0 0;0.0208333333333333 0 0;0.03125 0 0;0.0416666666666667 0 0;0.0520833333333333 0 0;0.0625 0 0;0.0729166666666667 0 0;0.0833333333333333 0 0;0.09375 0 0;0.104166666666667 0 0;0.114583333333333 0 0;0.125 0 0;0.135416666666667 0 0;0.145833333333333 0 0;0.15625 0 0;0.166666666666667 0 0;0.177083333333333 0 0;0.1875 0 0;0.197916666666667 0 0;0.208333333333333 0 0;0.21875 0 0;0.229166666666667 0 0;0.239583333333333 0 0;0.25 0 0;0.260416666666667 0 0;0.270833333333333 0 0;0.28125 0 0;0.291666666666667 0 0;0.302083333333333 0 0;0.3125 0 0;0.322916666666667 0 0;0.333333333333333 0 0;0.34375 0 0;0.354166666666667 0 0;0.364583333333333 0 0;0.375 0 0;0.385416666666667 0 0;0.395833333333333 0 0;0.40625 0 0;0.416666666666667 0 0;0.427083333333333 0 0;0.4375 0 0;0.447916666666667 0 0;0.458333333333333 0 0;0.46875 0 0;0.479166666666667 0 0;0.489583333333333 0 0;0.5 0 0;0.510416666666667 0 0;0.520833333333333 0 0;0.53125 0 0;0.541666666666667 0 0;0.552083333333333 0 0;0.5625 0 0;0.572916666666667 0 0;0.583333333333333 0 0;0.59375 0 0;0.604166666666667 0 0;0.614583333333333 0 0;0.625 0 0;0.635416666666667 0 0;0.645833333333333 0 0;0.65625 0 0;0.666666666666667 0 0;0.677083333333333 0 0;0.6875 0 0;0.697916666666667 0 0;0.708333333333333 0 0;0.71875 0 0;0.729166666666667 0 0;0.739583333333333 0 0;0.75 0 0;0.760416666666667 0 0;0.770833333333333 0 0;0.78125 0 0;0.791666666666667 0 0;0.802083333333333 0 0;0.8125 0 0;0.822916666666667 0 0;0.833333333333333 0 0;0.84375 0 0;0.854166666666667 0 0;0.864583333333333 0 0;0.875 0 0;0.885416666666667 0 0;0.895833333333333 0 0;0.90625 0 0;0.916666666666667 0 0;0.927083333333333 0 0;0.9375 0 0;0.947916666666667 0 0;0.958333333333333 0 0;0.96875 0 0;0.979166666666667 0 0;0.989583333333333 0 0;1 0 0;1 0.0104166666666667 0;1 0.0208333333333333 0;1 0.03125 0;1 0.0416666666666667 0;1 0.0520833333333333 0;1 0.0625 0;1 0.0729166666666667 0;1 0.0833333333333333 0;1 0.09375 0;1 0.104166666666667 0;1 0.114583333333333 0;1 0.125 0;1 0.135416666666667 0;1 0.145833333333333 0;1 0.15625 0;1 0.166666666666667 0;1 0.177083333333333 0;1 0.1875 0;1 0.197916666666667 0;1 0.208333333333333 0;1 0.21875 0;1 0.229166666666667 0;1 0.239583333333333 0;1 0.25 0;1 0.260416666666667 0;1 0.270833333333333 0;1 0.28125 0;1 0.291666666666667 0;1 0.302083333333333 0;1 0.3125 0;1 0.322916666666667 0;1 0.333333333333333 0;1 0.34375 0;1 0.354166666666667 0;1 0.364583333333333 0;1 0.375 0;1 0.385416666666667 0;1 0.395833333333333 0;1 0.40625 0;1 0.416666666666667 0;1 0.427083333333333 0;1 0.4375 0;1 0.447916666666667 0;1 0.458333333333333 0;1 0.46875 0;1 0.479166666666667 0;1 0.489583333333333 0;1 0.5 0;1 0.510416666666667 0;1 0.520833333333333 0;1 0.53125 0;1 0.541666666666667 0;1 0.552083333333333 0;1 0.5625 0;1 0.572916666666667 0;1 0.583333333333333 0;1 0.59375 0;1 0.604166666666667 0;1 0.614583333333333 0;1 0.625 0;1 0.635416666666667 0;1 0.645833333333333 0;1 0.65625 0;1 0.666666666666667 0;1 0.677083333333333 0;1 0.6875 0;1 0.697916666666667 0;1 0.708333333333333 0;1 0.71875 0;1 0.729166666666667 0;1 0.739583333333333 0;1 0.75 0;1 0.760416666666667 0;1 0.770833333333333 0;1 0.78125 0;1 0.791666666666667 0;1 0.802083333333333 0;1 0.8125 0;1 0.822916666666667 0;1 0.833333333333333 0;1 0.84375 0;1 0.854166666666667 0;1 0.864583333333333 0;1 0.875 0;1 0.885416666666667 0;1 0.895833333333333 0;1 0.90625 0;1 0.916666666666667 0;1 0.927083333333333 0;1 0.9375 0;1 0.947916666666667 0;1 0.958333333333333 0;1 0.96875 0;1 0.979166666666667 0;1 0.989583333333333 0;1 1 0;1 1 0.015625;1 1 0.03125;1 1 0.046875;1 1 0.0625;1 1 0.078125;1 1 0.09375;1 1 0.109375;1 1 0.125;1 1 0.140625;1 1 0.15625;1 1 0.171875;1 1 0.1875;1 1 0.203125;1 1 0.21875;1 1 0.234375;1 1 0.25;1 1 0.265625;1 1 0.28125;1 1 0.296875;1 1 0.3125;1 1 0.328125;1 1 0.34375;1 1 0.359375;1 1 0.375;1 1 0.390625;1 1 0.40625;1 1 0.421875;1 1 0.4375;1 1 0.453125;1 1 0.46875;1 1 0.484375;1 1 0.5;1 1 0.515625;1 1 0.53125;1 1 0.546875;1 1 0.5625;1 1 0.578125;1 1 0.59375;1 1 0.609375;1 1 0.625;1 1 0.640625;1 1 0.65625;1 1 0.671875;1 1 0.6875;1 1 0.703125;1 1 0.71875;1 1 0.734375;1 1 0.75;1 1 0.765625;1 1 0.78125;1 1 0.796875;1 1 0.8125;1 1 0.828125;1 1 0.84375;1 1 0.859375;1 1 0.875;1 1 0.890625;1 1 0.90625;1 1 0.921875;1 1 0.9375;1 1 0.953125;1 1 0.96875;1 1 0.984375;1 1 1]);
%colorbar(subplot2);
%subplot3 = subplot(1,5,3,'Parent',figure1); % for k3
%axis off
%hold(subplot3,'on');
%image(k3,'Parent',subplot3,'CDataMapping','scaled','Interpolation', 'bilinear');
%title({'k3'});
%set(subplot3,'CLim',[0.01 1],'ColorScale','log','Colormap',...
%    [0.0104166666666667 0 0;0.0208333333333333 0 0;0.03125 0 0;0.0416666666666667 0 0;0.0520833333333333 0 0;0.0625 0 0;0.0729166666666667 0 0;0.0833333333333333 0 0;0.09375 0 0;0.104166666666667 0 0;0.114583333333333 0 0;0.125 0 0;0.135416666666667 0 0;0.145833333333333 0 0;0.15625 0 0;0.166666666666667 0 0;0.177083333333333 0 0;0.1875 0 0;0.197916666666667 0 0;0.208333333333333 0 0;0.21875 0 0;0.229166666666667 0 0;0.239583333333333 0 0;0.25 0 0;0.260416666666667 0 0;0.270833333333333 0 0;0.28125 0 0;0.291666666666667 0 0;0.302083333333333 0 0;0.3125 0 0;0.322916666666667 0 0;0.333333333333333 0 0;0.34375 0 0;0.354166666666667 0 0;0.364583333333333 0 0;0.375 0 0;0.385416666666667 0 0;0.395833333333333 0 0;0.40625 0 0;0.416666666666667 0 0;0.427083333333333 0 0;0.4375 0 0;0.447916666666667 0 0;0.458333333333333 0 0;0.46875 0 0;0.479166666666667 0 0;0.489583333333333 0 0;0.5 0 0;0.510416666666667 0 0;0.520833333333333 0 0;0.53125 0 0;0.541666666666667 0 0;0.552083333333333 0 0;0.5625 0 0;0.572916666666667 0 0;0.583333333333333 0 0;0.59375 0 0;0.604166666666667 0 0;0.614583333333333 0 0;0.625 0 0;0.635416666666667 0 0;0.645833333333333 0 0;0.65625 0 0;0.666666666666667 0 0;0.677083333333333 0 0;0.6875 0 0;0.697916666666667 0 0;0.708333333333333 0 0;0.71875 0 0;0.729166666666667 0 0;0.739583333333333 0 0;0.75 0 0;0.760416666666667 0 0;0.770833333333333 0 0;0.78125 0 0;0.791666666666667 0 0;0.802083333333333 0 0;0.8125 0 0;0.822916666666667 0 0;0.833333333333333 0 0;0.84375 0 0;0.854166666666667 0 0;0.864583333333333 0 0;0.875 0 0;0.885416666666667 0 0;0.895833333333333 0 0;0.90625 0 0;0.916666666666667 0 0;0.927083333333333 0 0;0.9375 0 0;0.947916666666667 0 0;0.958333333333333 0 0;0.96875 0 0;0.979166666666667 0 0;0.989583333333333 0 0;1 0 0;1 0.0104166666666667 0;1 0.0208333333333333 0;1 0.03125 0;1 0.0416666666666667 0;1 0.0520833333333333 0;1 0.0625 0;1 0.0729166666666667 0;1 0.0833333333333333 0;1 0.09375 0;1 0.104166666666667 0;1 0.114583333333333 0;1 0.125 0;1 0.135416666666667 0;1 0.145833333333333 0;1 0.15625 0;1 0.166666666666667 0;1 0.177083333333333 0;1 0.1875 0;1 0.197916666666667 0;1 0.208333333333333 0;1 0.21875 0;1 0.229166666666667 0;1 0.239583333333333 0;1 0.25 0;1 0.260416666666667 0;1 0.270833333333333 0;1 0.28125 0;1 0.291666666666667 0;1 0.302083333333333 0;1 0.3125 0;1 0.322916666666667 0;1 0.333333333333333 0;1 0.34375 0;1 0.354166666666667 0;1 0.364583333333333 0;1 0.375 0;1 0.385416666666667 0;1 0.395833333333333 0;1 0.40625 0;1 0.416666666666667 0;1 0.427083333333333 0;1 0.4375 0;1 0.447916666666667 0;1 0.458333333333333 0;1 0.46875 0;1 0.479166666666667 0;1 0.489583333333333 0;1 0.5 0;1 0.510416666666667 0;1 0.520833333333333 0;1 0.53125 0;1 0.541666666666667 0;1 0.552083333333333 0;1 0.5625 0;1 0.572916666666667 0;1 0.583333333333333 0;1 0.59375 0;1 0.604166666666667 0;1 0.614583333333333 0;1 0.625 0;1 0.635416666666667 0;1 0.645833333333333 0;1 0.65625 0;1 0.666666666666667 0;1 0.677083333333333 0;1 0.6875 0;1 0.697916666666667 0;1 0.708333333333333 0;1 0.71875 0;1 0.729166666666667 0;1 0.739583333333333 0;1 0.75 0;1 0.760416666666667 0;1 0.770833333333333 0;1 0.78125 0;1 0.791666666666667 0;1 0.802083333333333 0;1 0.8125 0;1 0.822916666666667 0;1 0.833333333333333 0;1 0.84375 0;1 0.854166666666667 0;1 0.864583333333333 0;1 0.875 0;1 0.885416666666667 0;1 0.895833333333333 0;1 0.90625 0;1 0.916666666666667 0;1 0.927083333333333 0;1 0.9375 0;1 0.947916666666667 0;1 0.958333333333333 0;1 0.96875 0;1 0.979166666666667 0;1 0.989583333333333 0;1 1 0;1 1 0.015625;1 1 0.03125;1 1 0.046875;1 1 0.0625;1 1 0.078125;1 1 0.09375;1 1 0.109375;1 1 0.125;1 1 0.140625;1 1 0.15625;1 1 0.171875;1 1 0.1875;1 1 0.203125;1 1 0.21875;1 1 0.234375;1 1 0.25;1 1 0.265625;1 1 0.28125;1 1 0.296875;1 1 0.3125;1 1 0.328125;1 1 0.34375;1 1 0.359375;1 1 0.375;1 1 0.390625;1 1 0.40625;1 1 0.421875;1 1 0.4375;1 1 0.453125;1 1 0.46875;1 1 0.484375;1 1 0.5;1 1 0.515625;1 1 0.53125;1 1 0.546875;1 1 0.5625;1 1 0.578125;1 1 0.59375;1 1 0.609375;1 1 0.625;1 1 0.640625;1 1 0.65625;1 1 0.671875;1 1 0.6875;1 1 0.703125;1 1 0.71875;1 1 0.734375;1 1 0.75;1 1 0.765625;1 1 0.78125;1 1 0.796875;1 1 0.8125;1 1 0.828125;1 1 0.84375;1 1 0.859375;1 1 0.875;1 1 0.890625;1 1 0.90625;1 1 0.921875;1 1 0.9375;1 1 0.953125;1 1 0.96875;1 1 0.984375;1 1 1]);
%colorbar(subplot3);
%subplot4 = subplot(1,5,4,'Parent',figure1); % for Ki
%axis off
%hold(subplot4,'on');
%image(Ki,'Parent',subplot4,'CDataMapping','scaled','Interpolation', 'bilinear');
%title({'Ki'});
%set(subplot4,'CLim',[0.001 1],'ColorScale','log','Colormap',...
%    [0.0104166666666667 0 0;0.0208333333333333 0 0;0.03125 0 0;0.0416666666666667 0 0;0.0520833333333333 0 0;0.0625 0 0;0.0729166666666667 0 0;0.0833333333333333 0 0;0.09375 0 0;0.104166666666667 0 0;0.114583333333333 0 0;0.125 0 0;0.135416666666667 0 0;0.145833333333333 0 0;0.15625 0 0;0.166666666666667 0 0;0.177083333333333 0 0;0.1875 0 0;0.197916666666667 0 0;0.208333333333333 0 0;0.21875 0 0;0.229166666666667 0 0;0.239583333333333 0 0;0.25 0 0;0.260416666666667 0 0;0.270833333333333 0 0;0.28125 0 0;0.291666666666667 0 0;0.302083333333333 0 0;0.3125 0 0;0.322916666666667 0 0;0.333333333333333 0 0;0.34375 0 0;0.354166666666667 0 0;0.364583333333333 0 0;0.375 0 0;0.385416666666667 0 0;0.395833333333333 0 0;0.40625 0 0;0.416666666666667 0 0;0.427083333333333 0 0;0.4375 0 0;0.447916666666667 0 0;0.458333333333333 0 0;0.46875 0 0;0.479166666666667 0 0;0.489583333333333 0 0;0.5 0 0;0.510416666666667 0 0;0.520833333333333 0 0;0.53125 0 0;0.541666666666667 0 0;0.552083333333333 0 0;0.5625 0 0;0.572916666666667 0 0;0.583333333333333 0 0;0.59375 0 0;0.604166666666667 0 0;0.614583333333333 0 0;0.625 0 0;0.635416666666667 0 0;0.645833333333333 0 0;0.65625 0 0;0.666666666666667 0 0;0.677083333333333 0 0;0.6875 0 0;0.697916666666667 0 0;0.708333333333333 0 0;0.71875 0 0;0.729166666666667 0 0;0.739583333333333 0 0;0.75 0 0;0.760416666666667 0 0;0.770833333333333 0 0;0.78125 0 0;0.791666666666667 0 0;0.802083333333333 0 0;0.8125 0 0;0.822916666666667 0 0;0.833333333333333 0 0;0.84375 0 0;0.854166666666667 0 0;0.864583333333333 0 0;0.875 0 0;0.885416666666667 0 0;0.895833333333333 0 0;0.90625 0 0;0.916666666666667 0 0;0.927083333333333 0 0;0.9375 0 0;0.947916666666667 0 0;0.958333333333333 0 0;0.96875 0 0;0.979166666666667 0 0;0.989583333333333 0 0;1 0 0;1 0.0104166666666667 0;1 0.0208333333333333 0;1 0.03125 0;1 0.0416666666666667 0;1 0.0520833333333333 0;1 0.0625 0;1 0.0729166666666667 0;1 0.0833333333333333 0;1 0.09375 0;1 0.104166666666667 0;1 0.114583333333333 0;1 0.125 0;1 0.135416666666667 0;1 0.145833333333333 0;1 0.15625 0;1 0.166666666666667 0;1 0.177083333333333 0;1 0.1875 0;1 0.197916666666667 0;1 0.208333333333333 0;1 0.21875 0;1 0.229166666666667 0;1 0.239583333333333 0;1 0.25 0;1 0.260416666666667 0;1 0.270833333333333 0;1 0.28125 0;1 0.291666666666667 0;1 0.302083333333333 0;1 0.3125 0;1 0.322916666666667 0;1 0.333333333333333 0;1 0.34375 0;1 0.354166666666667 0;1 0.364583333333333 0;1 0.375 0;1 0.385416666666667 0;1 0.395833333333333 0;1 0.40625 0;1 0.416666666666667 0;1 0.427083333333333 0;1 0.4375 0;1 0.447916666666667 0;1 0.458333333333333 0;1 0.46875 0;1 0.479166666666667 0;1 0.489583333333333 0;1 0.5 0;1 0.510416666666667 0;1 0.520833333333333 0;1 0.53125 0;1 0.541666666666667 0;1 0.552083333333333 0;1 0.5625 0;1 0.572916666666667 0;1 0.583333333333333 0;1 0.59375 0;1 0.604166666666667 0;1 0.614583333333333 0;1 0.625 0;1 0.635416666666667 0;1 0.645833333333333 0;1 0.65625 0;1 0.666666666666667 0;1 0.677083333333333 0;1 0.6875 0;1 0.697916666666667 0;1 0.708333333333333 0;1 0.71875 0;1 0.729166666666667 0;1 0.739583333333333 0;1 0.75 0;1 0.760416666666667 0;1 0.770833333333333 0;1 0.78125 0;1 0.791666666666667 0;1 0.802083333333333 0;1 0.8125 0;1 0.822916666666667 0;1 0.833333333333333 0;1 0.84375 0;1 0.854166666666667 0;1 0.864583333333333 0;1 0.875 0;1 0.885416666666667 0;1 0.895833333333333 0;1 0.90625 0;1 0.916666666666667 0;1 0.927083333333333 0;1 0.9375 0;1 0.947916666666667 0;1 0.958333333333333 0;1 0.96875 0;1 0.979166666666667 0;1 0.989583333333333 0;1 1 0;1 1 0.015625;1 1 0.03125;1 1 0.046875;1 1 0.0625;1 1 0.078125;1 1 0.09375;1 1 0.109375;1 1 0.125;1 1 0.140625;1 1 0.15625;1 1 0.171875;1 1 0.1875;1 1 0.203125;1 1 0.21875;1 1 0.234375;1 1 0.25;1 1 0.265625;1 1 0.28125;1 1 0.296875;1 1 0.3125;1 1 0.328125;1 1 0.34375;1 1 0.359375;1 1 0.375;1 1 0.390625;1 1 0.40625;1 1 0.421875;1 1 0.4375;1 1 0.453125;1 1 0.46875;1 1 0.484375;1 1 0.5;1 1 0.515625;1 1 0.53125;1 1 0.546875;1 1 0.5625;1 1 0.578125;1 1 0.59375;1 1 0.609375;1 1 0.625;1 1 0.640625;1 1 0.65625;1 1 0.671875;1 1 0.6875;1 1 0.703125;1 1 0.71875;1 1 0.734375;1 1 0.75;1 1 0.765625;1 1 0.78125;1 1 0.796875;1 1 0.8125;1 1 0.828125;1 1 0.84375;1 1 0.859375;1 1 0.875;1 1 0.890625;1 1 0.90625;1 1 0.921875;1 1 0.9375;1 1 0.953125;1 1 0.96875;1 1 0.984375;1 1 1]);
%colorbar(subplot4);
%subplot5 = subplot(1,5,5,'Parent',figure1); % for Vd
%axis off
%hold(subplot5,'on');
%image(Vd,'Parent',subplot5,'CDataMapping','scaled','Interpolation', 'bilinear');
%title({'Vd'});
%set(subplot5,'CLim',[0.01 10],'ColorScale','log','Colormap',...
%    [0.0104166666666667 0 0;0.0208333333333333 0 0;0.03125 0 0;0.0416666666666667 0 0;0.0520833333333333 0 0;0.0625 0 0;0.0729166666666667 0 0;0.0833333333333333 0 0;0.09375 0 0;0.104166666666667 0 0;0.114583333333333 0 0;0.125 0 0;0.135416666666667 0 0;0.145833333333333 0 0;0.15625 0 0;0.166666666666667 0 0;0.177083333333333 0 0;0.1875 0 0;0.197916666666667 0 0;0.208333333333333 0 0;0.21875 0 0;0.229166666666667 0 0;0.239583333333333 0 0;0.25 0 0;0.260416666666667 0 0;0.270833333333333 0 0;0.28125 0 0;0.291666666666667 0 0;0.302083333333333 0 0;0.3125 0 0;0.322916666666667 0 0;0.333333333333333 0 0;0.34375 0 0;0.354166666666667 0 0;0.364583333333333 0 0;0.375 0 0;0.385416666666667 0 0;0.395833333333333 0 0;0.40625 0 0;0.416666666666667 0 0;0.427083333333333 0 0;0.4375 0 0;0.447916666666667 0 0;0.458333333333333 0 0;0.46875 0 0;0.479166666666667 0 0;0.489583333333333 0 0;0.5 0 0;0.510416666666667 0 0;0.520833333333333 0 0;0.53125 0 0;0.541666666666667 0 0;0.552083333333333 0 0;0.5625 0 0;0.572916666666667 0 0;0.583333333333333 0 0;0.59375 0 0;0.604166666666667 0 0;0.614583333333333 0 0;0.625 0 0;0.635416666666667 0 0;0.645833333333333 0 0;0.65625 0 0;0.666666666666667 0 0;0.677083333333333 0 0;0.6875 0 0;0.697916666666667 0 0;0.708333333333333 0 0;0.71875 0 0;0.729166666666667 0 0;0.739583333333333 0 0;0.75 0 0;0.760416666666667 0 0;0.770833333333333 0 0;0.78125 0 0;0.791666666666667 0 0;0.802083333333333 0 0;0.8125 0 0;0.822916666666667 0 0;0.833333333333333 0 0;0.84375 0 0;0.854166666666667 0 0;0.864583333333333 0 0;0.875 0 0;0.885416666666667 0 0;0.895833333333333 0 0;0.90625 0 0;0.916666666666667 0 0;0.927083333333333 0 0;0.9375 0 0;0.947916666666667 0 0;0.958333333333333 0 0;0.96875 0 0;0.979166666666667 0 0;0.989583333333333 0 0;1 0 0;1 0.0104166666666667 0;1 0.0208333333333333 0;1 0.03125 0;1 0.0416666666666667 0;1 0.0520833333333333 0;1 0.0625 0;1 0.0729166666666667 0;1 0.0833333333333333 0;1 0.09375 0;1 0.104166666666667 0;1 0.114583333333333 0;1 0.125 0;1 0.135416666666667 0;1 0.145833333333333 0;1 0.15625 0;1 0.166666666666667 0;1 0.177083333333333 0;1 0.1875 0;1 0.197916666666667 0;1 0.208333333333333 0;1 0.21875 0;1 0.229166666666667 0;1 0.239583333333333 0;1 0.25 0;1 0.260416666666667 0;1 0.270833333333333 0;1 0.28125 0;1 0.291666666666667 0;1 0.302083333333333 0;1 0.3125 0;1 0.322916666666667 0;1 0.333333333333333 0;1 0.34375 0;1 0.354166666666667 0;1 0.364583333333333 0;1 0.375 0;1 0.385416666666667 0;1 0.395833333333333 0;1 0.40625 0;1 0.416666666666667 0;1 0.427083333333333 0;1 0.4375 0;1 0.447916666666667 0;1 0.458333333333333 0;1 0.46875 0;1 0.479166666666667 0;1 0.489583333333333 0;1 0.5 0;1 0.510416666666667 0;1 0.520833333333333 0;1 0.53125 0;1 0.541666666666667 0;1 0.552083333333333 0;1 0.5625 0;1 0.572916666666667 0;1 0.583333333333333 0;1 0.59375 0;1 0.604166666666667 0;1 0.614583333333333 0;1 0.625 0;1 0.635416666666667 0;1 0.645833333333333 0;1 0.65625 0;1 0.666666666666667 0;1 0.677083333333333 0;1 0.6875 0;1 0.697916666666667 0;1 0.708333333333333 0;1 0.71875 0;1 0.729166666666667 0;1 0.739583333333333 0;1 0.75 0;1 0.760416666666667 0;1 0.770833333333333 0;1 0.78125 0;1 0.791666666666667 0;1 0.802083333333333 0;1 0.8125 0;1 0.822916666666667 0;1 0.833333333333333 0;1 0.84375 0;1 0.854166666666667 0;1 0.864583333333333 0;1 0.875 0;1 0.885416666666667 0;1 0.895833333333333 0;1 0.90625 0;1 0.916666666666667 0;1 0.927083333333333 0;1 0.9375 0;1 0.947916666666667 0;1 0.958333333333333 0;1 0.96875 0;1 0.979166666666667 0;1 0.989583333333333 0;1 1 0;1 1 0.015625;1 1 0.03125;1 1 0.046875;1 1 0.0625;1 1 0.078125;1 1 0.09375;1 1 0.109375;1 1 0.125;1 1 0.140625;1 1 0.15625;1 1 0.171875;1 1 0.1875;1 1 0.203125;1 1 0.21875;1 1 0.234375;1 1 0.25;1 1 0.265625;1 1 0.28125;1 1 0.296875;1 1 0.3125;1 1 0.328125;1 1 0.34375;1 1 0.359375;1 1 0.375;1 1 0.390625;1 1 0.40625;1 1 0.421875;1 1 0.4375;1 1 0.453125;1 1 0.46875;1 1 0.484375;1 1 0.5;1 1 0.515625;1 1 0.53125;1 1 0.546875;1 1 0.5625;1 1 0.578125;1 1 0.59375;1 1 0.609375;1 1 0.625;1 1 0.640625;1 1 0.65625;1 1 0.671875;1 1 0.6875;1 1 0.703125;1 1 0.71875;1 1 0.734375;1 1 0.75;1 1 0.765625;1 1 0.78125;1 1 0.796875;1 1 0.8125;1 1 0.828125;1 1 0.84375;1 1 0.859375;1 1 0.875;1 1 0.890625;1 1 0.90625;1 1 0.921875;1 1 0.9375;1 1 0.953125;1 1 0.96875;1 1 0.984375;1 1 1]);
%colorbar(subplot5);



















%%%%% Various Testing!! %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Testing of Python Library performance (Numpy & Scipy)
%x=[1:1:16];
%y=[1.1, 2.3, 3.5, 4.5, 5.1, 6.8, 7.7, 8.1, 9.5, 10.5, 11.2, 12.5, 13.7, 14.8, 15.3, 16.4];
%xdata=py.numpy.array(x);
%ydata=py.numpy.array(y);
%initial=py.numpy.array([0.5, 0.5]);
%bounds_temp=py.numpy.array([-10,-10;10,10]);
%bounds=py.tuple(bounds_temp);
%args_temp=py.numpy.array([x;y]);
%args=py.tuple(args_temp);
%tic;
%fit_result=py.scipy.optimize.curve_fit(@ py.mymodlinear.Linear, xdata, ydata, pyargs('p0',initial,'bounds',bounds));
%toc;
%Estimates=double(fit_result{1,1});
%Cov=double(fit_result{1,2});
%SE_A= sqrt(Cov(1,1));
%SE_B= sqrt(Cov(2,2));
%Fitted_Y=Estimates(1,1)*x + Estimates(1,2);
%SSE=sum((y-Fitted_Y).^(2));
%Starting_test=[0.5;0.5;]; % slope, intercept
%LB_test=[-10; -10]; % Lower Bound
%UB_test=[10; 10]; % Upper Bound
%tic;
%[test_Estimates,test_SSE,test_Residual,d,e,f,test_Jacobian]=lsqcurvefit(@test_fit_vector, Starting_test, x, y, LB_test, UB_test);
%toc;
%% Testing for comparison: Matlab(itself) v.s. Matlab (with python library) v.s. Python (itself)
% (Patlak)
% Matlab (itself)
%x=[1;2;3;4;5;6;7;8;9;10;11;12;13;14;15;16];
%y=[1.1;2.3;3.4;4.6;5.5;6.1;7.8;8.9;9.6;10.6;11.3;12.5;13.6;14.5;15.7;16.9];
%Starting_Patlak=[0.5;0.5]; % K_i:net influx rate (slope), V_d: volume of dist. (intercept)
%LB_Patlak=[0;0]; % Lower Bound of the Kinetic Parameters (i.e., Rate Constants)
%UB_Patlak=[1;1]; % Upper Bound of the Kinetic Parameters (i.e., Rate Constants)
%tic;
%[Patlak_v_Estimates,Patlak_v_SSE,Patlak_Residual,d,e,f,Patlak_Jacobian]=lsqcurvefit(@Patlak_vector, Starting_Patlak, x, y , LB_Patlak, UB_Patlak);
%toc;
% Matlab (with python library)
%x=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16];
%y=[1.1, 2.3, 3.4, 4.6, 5.5, 6.1, 7.8, 8.9, 9.6, 10.6, 11.3, 12.5, 13.6, 14.5, 15.7, 16.9];
%xdata=py.numpy.array(x);
%ydata=py.numpy.array(y);
%initial=py.numpy.array([0.5, 0.5]);
%bounds_temp=py.numpy.array([0,0;1,1]);
%bounds=py.tuple(bounds_temp);
%args_temp=py.numpy.array([x;y]);
%args=py.tuple(args_temp);
%tic;
%fit_result=py.scipy.optimize.curve_fit(@ py.Patlak_Python.Patlak, xdata, ydata, pyargs('p0',initial,'bounds',bounds));
%toc;
%Patlak_MAT_Python_Lib_Estimates=double(fit_result{1,1});
% (Linear Fit)
% Matlab (itself)
%x=[1;2;3;4;5;6;7;8;9;10;11;12;13;14;15;16];
%y=[1.1;2.3;3.4;4.6;5.5;6.1;7.8;8.9;9.6;10.6;11.3;12.5;13.6;14.5;15.7;16.9];
%Starting_Linear=[0.5;0.5]; % slope, intercept
%LB_Linear=[-10; -10]; % Lower Bound
%UB_Linear=[10; 10]; % Upper Bound
%tic;
%[Linear_Estimates,Linear_SSE,Linear_Residual,d,e,f,Linear_Jacobian]=lsqcurvefit(@Linear_Fit, Starting_Linear, x, y , LB_Linear, UB_Linear);
%toc;
% Matlab (with python library)
%x=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16];
%y=[1.1, 2.3, 3.4, 4.6, 5.5, 6.1, 7.8, 8.9, 9.6, 10.6, 11.3, 12.5, 13.6, 14.5, 15.7, 16.9];
%xdata=py.numpy.array(x);
%ydata=py.numpy.array(y);
%initial=py.numpy.array([0.5, 0.5]);
%bounds_temp=py.numpy.array([-10,-10;10,10]);
%bounds=py.tuple(bounds_temp);
%args_temp=py.numpy.array([x;y]);
%args=py.tuple(args_temp);
%tic;
%fit_result=py.numpy.polyfit(xdata, ydata, 1);
%toc;
%Linear_MAT_Python_Lib_Estimates=double(fit_result);
%% Testing of Polyfit! (for linear fit)
%x=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16];
%y=[1.1, 2.3, 3.4, 4.6, 5.5, 6.1, 7.8, 8.9, 9.6, 10.6, 11.3, 12.5, 13.6, 14.5, 15.7, 16.9];
%x_vert=transpose(x);
%y_vert=transpose(y);
%tic;
%p=polyfit(x,y,1);
%toc;
%tic;
%p_n=polyfitn(x,y,1);
%toc;
%Starting_Linear=[0.5;0.5]; % slope, intercept
%LB_Linear=[-10; -10]; % Lower Bound
%UB_Linear=[10; 10]; % Upper Bound
%tic;
%[Linear_Estimates,Linear_SSE,Linear_Residual,d,e,f,Linear_Jacobian]=lsqcurvefit(@Linear_Fit, Starting_Linear, x, y , LB_Linear, UB_Linear);
%toc;
%[ci, se]=nlparci(Linear_Estimates, Linear_Residual, 'jacobian', Linear_Jacobian);
%%%%% End of the various testing %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%




